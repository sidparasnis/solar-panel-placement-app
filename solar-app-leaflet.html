<!DOCTYPE html>
<html>
<head>
  <meta charset='utf-8' />
  <title>Solar Panel Price Calculator</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css"
  integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ=="
  crossorigin=""/>
  <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js"
  integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw=="
  crossorigin=""></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.2/leaflet.draw.css"/>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.2/leaflet.draw.js"></script>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
  <script src='https://npmcdn.com/@turf/turf/turf.min.js'></script>
  <script defer src="https://use.fontawesome.com/releases/v5.0.6/js/all.js"></script>

  <style>
    #map {
      position: absolute;
      top:0;
      bottom:0;
      width:100%; }
    body {
      margin: 0px;
      padding: 0px;
      width: 100%;
      height: 100%;
      font-size: 16px;
      background-color: #455A64;
    }
    #appWindow {

        margin-left: 20px;
        margin-right: 20px;
    }
    #title {
      margin-top: 20px;
      height:60px;
      text-align: center;
      color: #FF8A65;
    }
    #searchPanel {
      background-color: #FFD54F;

      margin-bottom: 20px;
    }
    #infoPanel {
      background-color: #FFF176;
    }
    #param {
      width: 80%;
      border: 0;
      border-bottom-left-radius: 3px;
      border-top-left-radius: 3px;
    }
    #searchButton {
      border-bottom-left-radius: 0px;
      border-top-left-radius: 0px;
    }
    .card {
      margin-left: 20px;
      box-shadow: 0px 7px 5px black;
    }
  </style>
</head>

<body>
  <div id="title">
    <h3>Solar Panel Price Calculator</h3>
  </div>

  <div id="appWindow">
    <div class="row">
      <div class="col-md-8" style="height:800px;">
          <div id='map' style="height:794px; border-radius:3px; box-shadow: 0px 7px 5px black;"></div>
      </div>

      <div class="col-md-4" style="height:800px;">
        <div class="card"  id="searchPanel">
          <div class="card-body">
            <div id="custom-search-input">
                <div class="input-group col-md-12">
                    <input type="text" class="f input-lg" placeholder="Enter a location..." id="param" />
                    <span class="input-group-btn">
                        <button class="btn btn-info btn-lg" type="button" onClick="httpGetAsync(document.getElementById('param').value, moveMap);" id="searchButton">
                            <i class="fas fa-search"></i>
                        </button>
                    </span>
                </div>
            </div>
          </div>
        </div>
        <div class="card" style="height:685px;" id="infoPanel">
          <div class="card-body" id="infoBox">
            yooooooooooooooo
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    var map = L.map('map', {drawControl: true}).setView([51.505, -0.09], 17);

    L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);

    var area = 0;

    map.on('draw:created', function (e) {
        // Do whatever else you need to. (save to db, add to map etc)
        map.addLayer(e.layer);
        console.log(e.layer.toGeoJSON().geometry.coordinates);
        var polygon = turf.polygon(e.layer.toGeoJSON().geometry.coordinates);
        area += turf.area(polygon);
        document.getElementById("infoBox").innerHTML = area;

    });

    function moveMap(res) {
      //console.log(term)
      var resJSON = JSON.parse(res);
      console.log(resJSON);
      var lat = resJSON.results[0].geometry.location.lat;
      var lng = resJSON.results[0].geometry.location.lng;
      console.log(lat, lng);
      map.panTo(new L.LatLng(lat, lng));
    };

    function httpGetAsync(term, cb)
    {
        var theUrl = "https://maps.googleapis.com/maps/api/geocode/json?address=" + term + "&key=AIzaSyB_L9c5d5kZyo3B1OQ-e020RYGaGSQWNRY"
        console.log(theUrl);
        var xmlHttp = new XMLHttpRequest();
        xmlHttp.onreadystatechange = function() {
            if (xmlHttp.readyState == 4 && xmlHttp.status == 200)
                cb(xmlHttp.responseText);
        }
        xmlHttp.open("GET", theUrl, true); // true for asynchronous
        xmlHttp.send(null);
    }
  </script>
</body>
</html>
